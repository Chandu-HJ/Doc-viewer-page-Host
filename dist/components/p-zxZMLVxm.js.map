{"file":"p-zxZMLVxm.js","mappings":"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","names":["__stencil_proxyCustomElement","HTMLElement"],"sources":["src/components/doc-page/doc-page.css?tag=doc-page","src/components/doc-page/doc-page.tsx"],"sourcesContent":["/* src/components/doc-page/doc-page.css */\r\n\r\n/* Wrapper around each rendered page (PDF / image / text) */\r\n.page-wrapper {\r\n  margin: 24px auto;\r\n  position: relative;\r\n  width: fit-content;\r\n  max-width: 100%;\r\n}\r\n\r\n/* pdf.js page container */\r\n.pdfViewerPage .page {\r\n  position: relative;\r\n  border-radius: 16px;\r\n  overflow: hidden;\r\n\r\n  /* Glass card look on page */\r\n  box-shadow: 0 18px 40px rgba(0, 0, 0, 0.35);\r\n  background: radial-gradient(circle at top left, #ffffff 0%, #f3f3f3 40%, #e4e4e4 100%);\r\n}\r\n\r\n/* Highlight overlay (annotations layer) */\r\n.annotationLayer {\r\n  position: absolute;\r\n  inset: 0;\r\n  z-index: 20;\r\n  pointer-events: auto;\r\n}\r\n\r\n/* Highlight rectangles (glass neon) */\r\n.annotationRect {\r\n  position: absolute;\r\n  background: radial-gradient(circle at top left,\r\n    rgba(255, 255, 170, 0.55),\r\n    rgba(255, 210, 90, 0.35));\r\n  border-radius: 6px;\r\n  box-shadow:\r\n    0 0 0 1px rgba(255, 250, 200, 0.5),\r\n    0 0 18px rgba(255, 255, 150, 0.6);\r\n  pointer-events: none;\r\n}\r\n\r\n/* Comment / note icons */\r\n.comment-icon,\r\n.note-icon {\r\n  position: absolute;\r\n  font-size: 18px;\r\n  cursor: pointer;\r\n  z-index: 30;\r\n  user-select: none;\r\n\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n\r\n  width: 28px;\r\n  height: 28px;\r\n  border-radius: 999px;\r\n  backdrop-filter: blur(10px);\r\n  -webkit-backdrop-filter: blur(10px);\r\n\r\n  background: radial-gradient(circle at top left,\r\n    rgba(0, 180, 255, 0.9),\r\n    rgba(90, 70, 250, 0.9));\r\n  box-shadow:\r\n    0 6px 16px rgba(0, 0, 0, 0.35),\r\n    0 0 12px rgba(0, 184, 255, 0.7);\r\n\r\n  color: #fdfdfd;\r\n  transition: transform 0.18s ease, box-shadow 0.18s ease, background 0.18s ease;\r\n}\r\n\r\n.note-icon {\r\n  background: radial-gradient(circle at top left,\r\n    rgba(255, 140, 80, 0.95),\r\n    rgba(255, 77, 77, 0.95));\r\n  box-shadow:\r\n    0 6px 16px rgba(0, 0, 0, 0.35),\r\n    0 0 12px rgba(255, 130, 80, 0.8);\r\n}\r\n\r\n.comment-icon:hover,\r\n.note-icon:hover {\r\n  transform: translateY(-2px) scale(1.04);\r\n  box-shadow:\r\n    0 10px 28px rgba(0, 0, 0, 0.45),\r\n    0 0 16px rgba(0, 200, 255, 0.9);\r\n}\r\n\r\n/* Ensure text layer does not block clicks */\r\n\r\n\r\n\r\n.virtual-page-wrapper {\r\n  width: 100%;\r\n  display: flex;\r\n  justify-content: center;\r\n  margin-bottom: 20px;\r\n}\r\n\r\n/* ================================\r\n   NOTE TEXT BUBBLE (PREVIEW)\r\n================================ */\r\n\r\n.note-bubble {\r\n  position: absolute;\r\n  max-width: 240px;\r\n  padding: 10px 14px;\r\n  font-size: 13px;\r\n  border-radius: 12px;\r\n\r\n  background: rgba(255, 250, 240, 0.92);\r\n  backdrop-filter: blur(12px);\r\n  -webkit-backdrop-filter: blur(12px);\r\n\r\n  box-shadow:\r\n    0 4px 18px rgba(0, 0, 0, 0.28),\r\n    0 0 12px rgba(255, 180, 120, 0.6);\r\n\r\n  color: #4b2b1f;\r\n  z-index: 50;\r\n  opacity: 0;\r\n  pointer-events: none;\r\n  transform: translateY(-6px);\r\n  transition: opacity 0.2s ease, transform 0.2s ease;\r\n}\r\n\r\n.note-bubble.visible {\r\n  opacity: 1;\r\n  transform: translateY(0px);\r\n}\r\n\r\n/* Positioning helpers */\r\n.note-bubble.left {\r\n  transform: translate(-110%, -10%);\r\n}\r\n\r\n.note-bubble.right {\r\n  transform: translate(32px, -10%);\r\n}\r\n.note-bubble {\r\n  position: absolute;\r\n  max-width: 240px;\r\n  padding: 10px 14px;\r\n  font-size: 13px;\r\n  border-radius: 12px;\r\n\r\n  background: rgba(255, 250, 240, 0.92);\r\n  backdrop-filter: blur(12px);\r\n  -webkit-backdrop-filter: blur(12px);\r\n\r\n  box-shadow:\r\n    0 4px 18px rgba(0, 0, 0, 0.28),\r\n    0 0 12px rgba(255, 180, 120, 0.6);\r\n\r\n  color: #4b2b1f;\r\n  z-index: 50;\r\n  opacity: 0;\r\n  pointer-events: none;\r\n  transform: translateY(-6px);\r\n  transition: opacity 0.2s ease, transform 0.2s ease;\r\n}\r\n\r\n.note-bubble.visible {\r\n  opacity: 1;\r\n  transform: translateY(0px);\r\n}\r\n\r\n.note-bubble.left {\r\n  transform: translate(-110%, -10%);\r\n}\r\n\r\n.note-bubble.right {\r\n  transform: translate(32px, -10%);\r\n}\r\n.pdfViewerPage.select-mode .textLayer {\r\n  pointer-events: auto !important;\r\n}\r\n","import {\r\n  Component,\r\n  h,\r\n  Prop,\r\n  Element,\r\n  Event,\r\n  EventEmitter,\r\n  Watch,\r\n} from '@stencil/core';\r\nimport { NormalizedRect } from '../../types/annotations';\r\nimport { PageComment, AnnotationKind } from '../../types/comments';\r\n\r\nconst pdfjsLib = (window as any).pdfjsLib;\r\nconst pdfjsViewer = (window as any).pdfjsViewer;\r\n\r\npdfjsLib.GlobalWorkerOptions.workerSrc = '/assets/pdf.worker.js';\r\n\r\n@Component({\r\n  tag: 'doc-page',\r\n  styleUrl: 'doc-page.css',\r\n  shadow: false,\r\n})\r\nexport class DocPage {\r\n  @Element() host!: HTMLElement;\r\n\r\n  @Prop() src!: string;\r\n  @Prop() page!: number;\r\n  @Prop() scale: number = 1.2;\r\n  @Prop() fileType: 'pdf' | 'image' | 'text' = 'pdf';\r\n\r\n  @Prop() activeTool: 'select' | 'highlight' | 'comment' | 'note' = 'select';\r\n\r\n  // readOnly = true ‚Üí no drawing/adding annotations\r\n  @Prop() readOnly: boolean = false;\r\n\r\n  // virtual / lazy rendering flag\r\n  @Prop() visible: boolean = false;\r\n\r\n  @Prop() annotations: NormalizedRect[] = [];\r\n  @Prop() comments: PageComment[] = [];\r\n\r\n  @Event() annotationCreated!: EventEmitter<{ page: number; rect: NormalizedRect }>;\r\n  @Event() commentAddRequested!: EventEmitter<{\r\n    page: number;\r\n    x: number;\r\n    y: number;\r\n    kind: AnnotationKind;\r\n  }>;\r\n  @Event() commentIconClicked!: EventEmitter<{ page: number; commentId: string }>;\r\n\r\n  private viewerContainer!: HTMLDivElement;\r\n  private annotationLayerEl: HTMLElement | null = null;\r\n\r\n  private isDrawing = false;\r\n  private startX = 0;\r\n  private startY = 0;\r\n  private currentRectEl: HTMLElement | null = null;\r\n\r\n  private hasRendered = false; // for lazy load\r\n\r\n  async componentDidLoad() {\r\n    await this.ensureRendered();\r\n  }\r\n\r\n  @Watch('visible')\r\n  async visibleChanged() {\r\n    await this.ensureRendered();\r\n  }\r\n\r\n  @Watch('annotations')\r\n  annotationsChanged() {\r\n    this.redrawHighlightsFromProps();\r\n  }\r\n\r\n  @Watch('comments')\r\n  commentsChanged() {\r\n    this.redrawCommentsFromProps();\r\n  }\r\n\r\n  @Watch('activeTool')\r\n  activeToolChanged() {\r\n    this.updatePointerEvents();\r\n  }\r\n\r\n  @Watch('readOnly')\r\n  readOnlyChanged() {\r\n    this.updatePointerEvents();\r\n  }\r\n\r\n  // ========== LAZY RENDERING ==========\r\n  private async ensureRendered() {\r\n    if (!this.visible) return; // not in viewport yet\r\n    if (this.hasRendered) return; // already rendered once\r\n\r\n    this.hasRendered = true;\r\n\r\n    if (this.fileType === 'image') {\r\n      await this.renderImagePage();\r\n    } else if (this.fileType === 'text') {\r\n      await this.renderTextPage();\r\n    } else {\r\n      await this.renderPdfPage();\r\n    }\r\n  }\r\n\r\n  // ========== RENDER TYPES ==========\r\n  private async renderPdfPage() {\r\n    const loadingTask = pdfjsLib.getDocument(this.src);\r\n    const pdf = await loadingTask.promise;\r\n\r\n    const page = await pdf.getPage(this.page);\r\n    const viewport = page.getViewport({ scale: this.scale });\r\n\r\n    const eventBus = new pdfjsViewer.EventBus();\r\n\r\n    const pageView = new pdfjsViewer.PDFPageView({\r\n      container: this.viewerContainer,\r\n      id: this.page,\r\n      scale: this.scale,\r\n      defaultViewport: viewport,\r\n      eventBus,\r\n      textLayerMode: 2,\r\n    });\r\n\r\n    pageView.setPdfPage(page);\r\n    await pageView.draw();\r\n\r\n    const pageDiv = pageView.div as HTMLElement;\r\n\r\n    // ‚úÖ Make sure layout is fully done before creating annotation layer\r\n    const setup = () => {\r\n      this.setupAnnotationLayer(pageDiv);\r\n      this.redrawHighlightsFromProps();\r\n      this.redrawCommentsFromProps();\r\n    };\r\n\r\n    // double RAF ‚Üí next layout + next paint\r\n    requestAnimationFrame(() => {\r\n      requestAnimationFrame(setup);\r\n    });\r\n  }\r\n\r\n  private async renderImagePage() {\r\n    const pageDiv = document.createElement('div');\r\n    pageDiv.classList.add('page');\r\n    pageDiv.style.position = 'relative';\r\n    this.viewerContainer.appendChild(pageDiv);\r\n\r\n    const img = document.createElement('img');\r\n    img.src = this.src;\r\n    img.style.display = 'block';\r\n    img.style.maxWidth = `${800 * this.scale}px`;\r\n\r\n    pageDiv.appendChild(img);\r\n\r\n    img.onload = () => {\r\n      this.setupAnnotationLayer(pageDiv);\r\n      this.redrawHighlightsFromProps();\r\n      this.redrawCommentsFromProps();\r\n    };\r\n  }\r\n\r\n  private async renderTextPage() {\r\n    const pageDiv = document.createElement('div');\r\n    pageDiv.classList.add('page');\r\n    pageDiv.style.position = 'relative';\r\n    this.viewerContainer.appendChild(pageDiv);\r\n\r\n    const textEl = document.createElement('pre');\r\n    textEl.classList.add('text-content');\r\n    textEl.style.fontSize = `${16 * this.scale}px`;\r\n    textEl.style.whiteSpace = 'pre-wrap';\r\n\r\n    const text = await fetch(this.src).then((r) => r.text());\r\n    textEl.textContent = text;\r\n    pageDiv.appendChild(textEl);\r\n\r\n    this.setupAnnotationLayer(pageDiv);\r\n    this.redrawHighlightsFromProps();\r\n    this.redrawCommentsFromProps();\r\n\r\n    // text highlight uses DOM selection\r\n    textEl.addEventListener('mouseup', () => this.handleTextMouseUp());\r\n  }\r\n\r\n  // ========== ANNOTATION LAYER ==========\r\n  private setupAnnotationLayer(pageDiv: HTMLElement) {\r\n    const old = pageDiv.querySelector('.annotationLayer');\r\n    if (old) old.remove();\r\n\r\n    const layer = document.createElement('div');\r\n    layer.classList.add('annotationLayer');\r\n    Object.assign(layer.style, {\r\n      position: 'absolute',\r\n      inset: '0',\r\n      zIndex: '999', // ensure it is on top of canvas/text\r\n      pointerEvents: 'auto',\r\n    });\r\n\r\n    this.annotationLayerEl = layer;\r\n    pageDiv.appendChild(layer);\r\n\r\n    // Attach mouse handlers for all file types; logic inside onMouseDown handles special cases\r\n    if (!this.readOnly) {\r\n      layer.addEventListener('mousedown', (e) => this.onMouseDown(e));\r\n      layer.addEventListener('mousemove', (e) => this.onMouseMove(e));\r\n      layer.addEventListener('mouseup', () => this.onMouseUp());\r\n    }\r\n\r\n    this.updatePointerEvents();\r\n  }\r\n\r\n  // Centralized control for pointer-events depending on tool + file type\r\n  private updatePointerEvents() {\r\n    if (!this.annotationLayerEl) return;\r\n\r\n    const layer = this.annotationLayerEl;\r\n\r\n    // READ ONLY ‚Üí pass-through except icons\r\n    if (this.readOnly) {\r\n      layer.style.pointerEvents = 'none';\r\n      layer\r\n        .querySelectorAll('.comment-icon, .note-icon')\r\n        .forEach((el) => ((el as HTMLElement).style.pointerEvents = 'auto'));\r\n      return;\r\n    }\r\n\r\n    if (this.fileType === 'text') {\r\n      // TEXT:\r\n      // - highlight/select ‚Üí let text receive events (selection)\r\n      // - comment/note ‚Üí layer must receive click for placement\r\n      if (this.activeTool === 'highlight' || this.activeTool === 'select') {\r\n        layer.style.pointerEvents = 'none';\r\n      } else {\r\n        // comment / note\r\n        layer.style.pointerEvents = 'auto';\r\n      }\r\n    } else {\r\n      // PDF / IMAGE:\r\n      // - select ‚Üí pass-through (no new drawings), icons clickable\r\n      // - others ‚Üí annotation layer active\r\n      if (this.activeTool === 'select') {\r\n        layer.style.pointerEvents = 'none';\r\n      } else {\r\n        layer.style.pointerEvents = 'auto';\r\n      }\r\n    }\r\n\r\n    // Icons should always be clickable\r\n    layer\r\n      .querySelectorAll('.comment-icon, .note-icon')\r\n      .forEach((el) => ((el as HTMLElement).style.pointerEvents = 'auto'));\r\n  }\r\n\r\n  // ========== MOUSE HANDLERS ==========\r\n  private onMouseDown(e: MouseEvent) {\r\n    if (!this.annotationLayerEl || this.readOnly) return;\r\n\r\n    const rect = this.annotationLayerEl.getBoundingClientRect();\r\n    if (!rect.width || !rect.height) return;\r\n\r\n    // COMMENT / NOTE (all file types)\r\n    if (this.activeTool === 'comment' || this.activeTool === 'note') {\r\n      const xNorm = (e.clientX - rect.left) / rect.width;\r\n      const yNorm = (e.clientY - rect.top) / rect.height;\r\n\r\n      this.commentAddRequested.emit({\r\n        page: this.page,\r\n        x: xNorm,\r\n        y: yNorm,\r\n        kind: this.activeTool === 'comment' ? 'comment' : 'note',\r\n      });\r\n      return;\r\n    }\r\n\r\n    // HIGHLIGHT for pdf/image (rectangle drawing)\r\n    if (this.activeTool !== 'highlight' || this.fileType === 'text') return;\r\n\r\n    this.isDrawing = true;\r\n    this.startX = e.clientX - rect.left;\r\n    this.startY = e.clientY - rect.top;\r\n\r\n    this.currentRectEl = document.createElement('div');\r\n    this.currentRectEl.className = 'annotationRect';\r\n    this.currentRectEl.style.left = `${this.startX}px`;\r\n    this.currentRectEl.style.top = `${this.startY}px`;\r\n\r\n    this.annotationLayerEl.appendChild(this.currentRectEl);\r\n  }\r\n\r\n  private onMouseMove(e: MouseEvent) {\r\n    if (this.readOnly) return;\r\n    if (!this.isDrawing || !this.currentRectEl || !this.annotationLayerEl) return;\r\n\r\n    const rect = this.annotationLayerEl.getBoundingClientRect();\r\n    if (!rect.width || !rect.height) return;\r\n\r\n    const x = e.clientX - rect.left;\r\n    const y = e.clientY - rect.top;\r\n\r\n    this.currentRectEl.style.width = `${x - this.startX}px`;\r\n    this.currentRectEl.style.height = `${y - this.startY}px`;\r\n  }\r\n\r\n  private onMouseUp() {\r\n    if (this.readOnly) return;\r\n    if (!this.isDrawing || !this.annotationLayerEl || !this.currentRectEl) return;\r\n\r\n    this.isDrawing = false;\r\n\r\n    const layerRect = this.annotationLayerEl.getBoundingClientRect();\r\n    const width = parseFloat(this.currentRectEl.style.width || '0');\r\n    const height = parseFloat(this.currentRectEl.style.height || '0');\r\n\r\n    if (width > 3 && height > 3 && layerRect.width && layerRect.height) {\r\n      const normalized: NormalizedRect = {\r\n        x: parseFloat(this.currentRectEl.style.left || '0') / layerRect.width,\r\n        y: parseFloat(this.currentRectEl.style.top || '0') / layerRect.height,\r\n        width: width / layerRect.width,\r\n        height: height / layerRect.height,\r\n      };\r\n\r\n      this.annotationCreated.emit({ page: this.page, rect: normalized });\r\n    }\r\n\r\n    this.currentRectEl.remove();\r\n    this.currentRectEl = null;\r\n  }\r\n\r\n  // ========== TEXT HIGHLIGHT ==========\r\n  private handleTextMouseUp() {\r\n    if (this.readOnly) return;\r\n    if (this.fileType !== 'text') return;\r\n    if (this.activeTool !== 'highlight') return;\r\n    if (!this.annotationLayerEl) return;\r\n\r\n    const sel = window.getSelection();\r\n    if (!sel || sel.isCollapsed) return;\r\n\r\n    const range = sel.getRangeAt(0);\r\n    const rect = range.getBoundingClientRect();\r\n    sel.removeAllRanges();\r\n\r\n    const layerRect = this.annotationLayerEl.getBoundingClientRect();\r\n    if (!layerRect.width || !layerRect.height || !rect.width || !rect.height) return;\r\n\r\n    const x = rect.left - layerRect.left;\r\n    const y = rect.top - layerRect.top;\r\n\r\n    const normalized: NormalizedRect = {\r\n      x: x / layerRect.width,\r\n      y: y / layerRect.height,\r\n      width: rect.width / layerRect.width,\r\n      height: rect.height / layerRect.height,\r\n    };\r\n\r\n    const el = document.createElement('div');\r\n    el.className = 'annotationRect';\r\n    el.style.left = `${x}px`;\r\n    el.style.top = `${y}px`;\r\n    el.style.width = `${rect.width}px`;\r\n    el.style.height = `${rect.height}px`;\r\n\r\n    this.annotationLayerEl.appendChild(el);\r\n    this.annotationCreated.emit({ page: this.page, rect: normalized });\r\n  }\r\n\r\n  // ========== REDRAW HIGHLIGHTS ==========\r\n  private redrawHighlightsFromProps() {\r\n    if (!this.annotationLayerEl) return;\r\n\r\n    this.annotationLayerEl.querySelectorAll('.annotationRect').forEach((el) => el.remove());\r\n\r\n    const layerRect = this.annotationLayerEl.getBoundingClientRect();\r\n    if (!layerRect.width || !layerRect.height) return;\r\n\r\n    this.annotations.forEach((a) => {\r\n      const el = document.createElement('div');\r\n      el.className = 'annotationRect';\r\n      el.style.left = `${a.x * layerRect.width}px`;\r\n      el.style.top = `${a.y * layerRect.height}px`;\r\n      el.style.width = `${a.width * layerRect.width}px`;\r\n      el.style.height = `${a.height * layerRect.height}px`;\r\n      this.annotationLayerEl!.appendChild(el);\r\n    });\r\n\r\n    // Ensure icons remain clickable after redraw\r\n    this.updatePointerEvents();\r\n  }\r\n\r\n  // ========== REDRAW COMMENTS + NOTES (WITH NOTE BUBBLE) ==========\r\n  private redrawCommentsFromProps() {\r\n    if (!this.annotationLayerEl) return;\r\n\r\n    // Remove old icons + bubbles\r\n    this.annotationLayerEl\r\n      .querySelectorAll('.comment-icon, .note-icon, .note-bubble')\r\n      .forEach((el) => el.remove());\r\n\r\n    const layerRect = this.annotationLayerEl.getBoundingClientRect();\r\n    if (!layerRect.width || !layerRect.height) return;\r\n\r\n    this.comments.forEach((c) => {\r\n      const isNote = c.kind === 'note';\r\n      const pxX = c.x * layerRect.width;\r\n      const pxY = c.y * layerRect.height;\r\n\r\n      // Create icon\r\n      const icon = document.createElement('div');\r\n      icon.className = isNote ? 'note-icon' : 'comment-icon';\r\n      icon.textContent = isNote ? 'üìù' : 'üí¨';\r\n      icon.style.left = `${pxX}px`;\r\n      icon.style.top = `${pxY}px`;\r\n\r\n      // --- COMMENTS (üí¨) ‚Üí icon only, click = open sidebar\r\n      if (!isNote) {\r\n        icon.addEventListener('click', (ev) => {\r\n          ev.stopPropagation();\r\n          this.commentIconClicked.emit({ page: this.page, commentId: c.id });\r\n        });\r\n        this.annotationLayerEl!.appendChild(icon);\r\n        return;\r\n      }\r\n\r\n      // --- NOTES (üìù) ‚Üí icon + popup text bubble\r\n      const bubble = document.createElement('div');\r\n      bubble.className = 'note-bubble';\r\n      bubble.textContent = c.text && c.text.trim() !== '' ? c.text : '(empty note)';\r\n\r\n      // Place near icon\r\n      bubble.style.left = `${pxX}px`;\r\n      bubble.style.top = `${pxY}px`;\r\n\r\n      // Decide left/right based on available space\r\n      const placeRight = pxX < layerRect.width * 0.6;\r\n      bubble.classList.add(placeRight ? 'right' : 'left');\r\n\r\n      // Hover ‚Üí show\r\n      icon.addEventListener('mouseenter', () => {\r\n        bubble.classList.add('visible');\r\n      });\r\n      icon.addEventListener('mouseleave', () => {\r\n        bubble.classList.remove('visible');\r\n      });\r\n\r\n      // Click ‚Üí toggle + open sidebar\r\n      icon.addEventListener('click', (ev) => {\r\n        ev.stopPropagation();\r\n        bubble.classList.toggle('visible');\r\n        this.commentIconClicked.emit({ page: this.page, commentId: c.id });\r\n      });\r\n\r\n      this.annotationLayerEl!.appendChild(bubble);\r\n      this.annotationLayerEl!.appendChild(icon);\r\n    });\r\n\r\n    // Make sure icons stay clickable\r\n    this.updatePointerEvents();\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <div class=\"page-wrapper\">\r\n        <div\r\n          class=\"pdfViewerPage\"\r\n          ref={(el) => (this.viewerContainer = el as HTMLDivElement)}\r\n        ></div>\r\n      </div>\r\n    );\r\n  }\r\n}\r\n"],"version":3}