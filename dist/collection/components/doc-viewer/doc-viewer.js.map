{"version":3,"file":"doc-viewer.js","sourceRoot":"","sources":["../../../src/components/doc-viewer/doc-viewer.tsx"],"names":[],"mappings":"AAAA,2CAA2C;AAC3C,OAAO,EAAE,SAAS,EAAE,CAAC,EAAE,IAAI,EAAE,KAAK,EAAE,MAAM,eAAe,CAAC;AAG1D,OAAO,EAAE,cAAc,EAAE,MAAM,qBAAqB,CAAC;AAErD,MAAM,QAAQ,GAAI,MAAc,CAAC,QAAQ,CAAC;AAC1C,MAAM,WAAW,GAAG,CAAC,MAAM,EAAE,WAAW,EAAE,MAAM,EAAE,UAAU,EAAE,MAAM,CAAC,CAAC;AAStE,MAAM,OAAO,SAAS;IACZ,GAAG,CAAU;IACb,KAAK,GAAW,GAAG,CAAC;IACpB,QAAQ,GAAa,KAAK,CAAC;IAEK,QAAQ,GAAY,KAAK,CAAC;IAE1B,KAAK,GAA+B,OAAO,CAAC;IAC5C,IAAI,GAAwB,QAAQ,CAAC;IAEpE,QAAQ,GAAG,CAAC,CAAC;IACb,UAAU,GAAgD,QAAQ,CAAC;IAEnE,WAAW,GAAqC,EAAE,CAAC;IACnD,QAAQ,GAAkC,EAAE,CAAC;IAE7C,WAAW,GAAG,KAAK,CAAC;IACpB,WAAW,GAAkB,IAAI,CAAC;IAClC,iBAAiB,GAAkB,IAAI,CAAC;IACxC,gBAAgB,GAAG,EAAE,CAAC;IACtB,eAAe,GAAG,MAAM,CAAC;IAElC,0CAA0C;IACjC,YAAY,GAAgC,EAAE,CAAC,EAAE,IAAI,EAAE,CAAC;IAEzD,OAAO,GAAG,IAAI,cAAc,EAGhC,CAAC;IAEG,WAAW,CAAoB;IAC/B,oBAAoB,CAAwB;IAEpD,gCAAgC;IACxB,UAAU,CAAC,IAAgC;QACjD,MAAM,IAAI,GAAG,IAAI,CAAC,GAAG,IAAI,SAAS,CAAC;QACnC,MAAM,IAAI,GAAG,IAAI,CAAC,OAAO,CAAC,aAAa,EAAE,GAAG,CAAC,CAAC;QAC9C,OAAO,MAAM,IAAI,IAAI,IAAI,EAAE,CAAC;IAC9B,CAAC;IAEO,cAAc,CAAC,GAAW;QAChC,MAAM,CAAC,GAAG,GAAG,CAAC,WAAW,EAAE,CAAC;QAC5B,IAAI,CAAC,CAAC,QAAQ,CAAC,MAAM,CAAC;YAAE,OAAO,KAAK,CAAC;QACrC,IAAI,CAAC,CAAC,KAAK,CAAC,6BAA6B,CAAC;YAAE,OAAO,OAAO,CAAC;QAC3D,IAAI,CAAC,CAAC,KAAK,CAAC,aAAa,CAAC;YAAE,OAAO,MAAM,CAAC;QAC1C,OAAO,MAAM,CAAC;IAChB,CAAC;IAED,KAAK,CAAC,gBAAgB;QACpB,MAAM,GAAG,GAAG,IAAI,GAAG,CAAC,MAAM,CAAC,QAAQ,CAAC,IAAI,CAAC,CAAC;QAC1C,IAAI,GAAG,CAAC,YAAY,CAAC,GAAG,CAAC,UAAU,CAAC,KAAK,MAAM;YAAE,IAAI,CAAC,QAAQ,GAAG,IAAI,CAAC;QAEtE,MAAM,GAAG,GAAG,YAAY,CAAC,OAAO,CAAC,IAAI,CAAC,UAAU,CAAC,aAAa,CAAC,CAAC,CAAC;QACjE,IAAI,GAAG;YAAE,IAAI,CAAC,WAAW,GAAG,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC;QAE5C,MAAM,EAAE,GAAG,YAAY,CAAC,OAAO,CAAC,IAAI,CAAC,UAAU,CAAC,UAAU,CAAC,CAAC,CAAC;QAC7D,IAAI,EAAE;YAAE,IAAI,CAAC,QAAQ,GAAG,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC,CAAC;QAEvC,IAAI,CAAC,IAAI,CAAC,QAAQ;YAAE,IAAI,CAAC,QAAQ,GAAG,IAAI,CAAC,cAAc,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;QAElE,IAAI,IAAI,CAAC,QAAQ,KAAK,KAAK,EAAE,CAAC;YAC5B,MAAM,IAAI,GAAG,QAAQ,CAAC,WAAW,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;YAC5C,MAAM,GAAG,GAAG,MAAM,IAAI,CAAC,OAAO,CAAC;YAC/B,IAAI,CAAC,QAAQ,GAAG,GAAG,CAAC,QAAQ,CAAC;QAC/B,CAAC;aAAM,CAAC;YACN,IAAI,CAAC,QAAQ,GAAG,CAAC,CAAC;QACpB,CAAC;QAED,IAAI,CAAC,OAAO,CAAC,SAAS,CAAC;YACrB,WAAW,EAAE,IAAI,CAAC,WAAW;YAC7B,QAAQ,EAAE,IAAI,CAAC,QAAQ;SACxB,CAAC,CAAC;QAEH,IAAI,CAAC,yBAAyB,EAAE,CAAC;IACnC,CAAC;IAEO,yBAAyB;QAC/B,IAAI,OAAO,oBAAoB,KAAK,WAAW;YAAE,OAAO;QAExD,IAAI,CAAC,oBAAoB,GAAG,IAAI,oBAAoB,CAClD,CAAC,OAAO,EAAE,EAAE;YACV,MAAM,OAAO,GAAG,EAAE,GAAG,IAAI,CAAC,YAAY,EAAE,CAAC;YACzC,IAAI,OAAO,GAAG,KAAK,CAAC;YAEpB,KAAK,MAAM,KAAK,IAAI,OAAO,EAAE,CAAC;gBAC5B,MAAM,EAAE,GAAG,KAAK,CAAC,MAAqB,CAAC;gBACvC,MAAM,OAAO,GAAG,EAAE,CAAC,YAAY,CAAC,WAAW,CAAC,CAAC;gBAC7C,IAAI,CAAC,OAAO;oBAAE,SAAS;gBACvB,MAAM,IAAI,GAAG,QAAQ,CAAC,OAAO,EAAE,EAAE,CAAC,CAAC;gBACnC,IAAI,CAAC,IAAI;oBAAE,SAAS;gBAEpB,IAAI,KAAK,CAAC,cAAc,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,EAAE,CAAC;oBAC3C,OAAO,CAAC,IAAI,CAAC,GAAG,IAAI,CAAC;oBACrB,OAAO,GAAG,IAAI,CAAC;gBACjB,CAAC;YACH,CAAC;YAED,IAAI,OAAO,EAAE,CAAC;gBACZ,IAAI,CAAC,YAAY,GAAG,OAAO,CAAC;YAC9B,CAAC;QACH,CAAC,EACD;YACE,SAAS,EAAE,GAAG;SACf,CACF,CAAC;IACJ,CAAC;IAEO,oBAAoB,GAAG,CAAC,EAAsB,EAAE,IAAY,EAAE,EAAE;QACtE,IAAI,CAAC,EAAE,IAAI,CAAC,IAAI,CAAC,oBAAoB;YAAE,OAAO;QAC9C,EAAE,CAAC,YAAY,CAAC,WAAW,EAAE,MAAM,CAAC,IAAI,CAAC,CAAC,CAAC;QAC3C,IAAI,CAAC,oBAAoB,CAAC,OAAO,CAAC,EAAE,CAAC,CAAC;IACxC,CAAC,CAAC;IAEF,sBAAsB;IACd,WAAW;QACjB,IAAI,CAAC,OAAO,CAAC,SAAS,CAAC;YACrB,WAAW,EAAE,IAAI,CAAC,WAAW;YAC7B,QAAQ,EAAE,IAAI,CAAC,QAAQ;SACxB,CAAC,CAAC;IACL,CAAC;IAEO,OAAO;QACb,YAAY,CAAC,OAAO,CAAC,IAAI,CAAC,UAAU,CAAC,aAAa,CAAC,EAAE,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,WAAW,CAAC,CAAC,CAAC;QACvF,YAAY,CAAC,OAAO,CAAC,IAAI,CAAC,UAAU,CAAC,UAAU,CAAC,EAAE,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC,CAAC;IACnF,CAAC;IAED,IAAI,GAAG,GAAG,EAAE;QACV,MAAM,KAAK,GAAG,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC;YAC9B,WAAW,EAAE,IAAI,CAAC,WAAW;YAC7B,QAAQ,EAAE,IAAI,CAAC,QAAQ;SACxB,CAAC,CAAC;QACH,IAAI,CAAC,KAAK;YAAE,OAAO;QACnB,IAAI,CAAC,WAAW,GAAG,KAAK,CAAC,WAAW,CAAC;QACrC,IAAI,CAAC,QAAQ,GAAG,KAAK,CAAC,QAAQ,CAAC;QAC/B,IAAI,CAAC,OAAO,EAAE,CAAC;IACjB,CAAC,CAAC;IAEF,IAAI,GAAG,GAAG,EAAE;QACV,MAAM,KAAK,GAAG,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC;YAC9B,WAAW,EAAE,IAAI,CAAC,WAAW;YAC7B,QAAQ,EAAE,IAAI,CAAC,QAAQ;SACxB,CAAC,CAAC;QACH,IAAI,CAAC,KAAK;YAAE,OAAO;QACnB,IAAI,CAAC,WAAW,GAAG,KAAK,CAAC,WAAW,CAAC;QACrC,IAAI,CAAC,QAAQ,GAAG,KAAK,CAAC,QAAQ,CAAC;QAC/B,IAAI,CAAC,OAAO,EAAE,CAAC;IACjB,CAAC,CAAC;IAEF,gCAAgC;IAChC,uBAAuB,GAAG,CAAC,EAAuD,EAAE,EAAE;QACpF,MAAM,EAAE,IAAI,EAAE,IAAI,EAAE,GAAG,EAAE,CAAC,MAAM,CAAC;QACjC,IAAI,CAAC,WAAW,EAAE,CAAC;QAEnB,MAAM,KAAK,GAAG,EAAE,GAAG,IAAI,CAAC,WAAW,EAAE,CAAC;QACtC,MAAM,IAAI,GAAG,KAAK,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC,GAAG,KAAK,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC;QACjD,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;QAChB,KAAK,CAAC,IAAI,CAAC,GAAG,IAAI,CAAC;QAEnB,IAAI,CAAC,WAAW,GAAG,KAAK,CAAC;QACzB,IAAI,CAAC,OAAO,EAAE,CAAC;IACjB,CAAC,CAAC;IAEF,yBAAyB,GAAG,CAC1B,EAA6E,EAC7E,EAAE;QACF,IAAI,CAAC,WAAW,EAAE,CAAC;QAEnB,MAAM,EAAE,IAAI,EAAE,CAAC,EAAE,CAAC,EAAE,IAAI,EAAE,GAAG,EAAE,CAAC,MAAM,CAAC;QACvC,MAAM,EAAE,GAAG,MAAM,CAAC,UAAU,CAAC,CAAC,CAAC,MAAM,CAAC,UAAU,EAAE,CAAC,CAAC,CAAC,IAAI,CAAC,GAAG,EAAE,CAAC,QAAQ,CAAC,EAAE,CAAC,CAAC;QAE7E,MAAM,OAAO,GAAG,EAAE,GAAG,IAAI,CAAC,QAAQ,EAAE,CAAC;QACrC,MAAM,IAAI,GAAG,OAAO,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC,GAAG,OAAO,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC;QAErD,IAAI,CAAC,IAAI,CAAC;YACR,EAAE;YACF,IAAI;YACJ,CAAC;YACD,CAAC;YACD,IAAI,EAAE,EAAE;YACR,GAAG,EAAE,MAAM;YACX,SAAS,EAAE,IAAI,IAAI,EAAE,CAAC,WAAW,EAAE;SACpC,CAAC,CAAC;QAEH,OAAO,CAAC,IAAI,CAAC,GAAG,IAAI,CAAC;QACrB,IAAI,CAAC,QAAQ,GAAG,OAAO,CAAC;QACxB,IAAI,CAAC,OAAO,EAAE,CAAC;QAEf,IAAI,CAAC,WAAW,GAAG,IAAI,CAAC;QACxB,IAAI,CAAC,WAAW,GAAG,IAAI,CAAC;QACxB,IAAI,CAAC,iBAAiB,GAAG,EAAE,CAAC;QAC5B,IAAI,CAAC,gBAAgB,GAAG,EAAE,CAAC;QAC3B,IAAI,CAAC,eAAe,GAAG,MAAM,CAAC;IAChC,CAAC,CAAC;IAEF,wBAAwB,GAAG,CAAC,EAAoD,EAAE,EAAE;QAClF,MAAM,EAAE,IAAI,EAAE,SAAS,EAAE,GAAG,EAAE,CAAC,MAAM,CAAC;QAEtC,IAAI,CAAC,WAAW,GAAG,IAAI,CAAC;QACxB,IAAI,CAAC,WAAW,GAAG,IAAI,CAAC;QACxB,IAAI,CAAC,iBAAiB,GAAG,SAAS,CAAC;QAEnC,MAAM,CAAC,GAAG,IAAI,CAAC,UAAU,CAAC,IAAI,EAAE,SAAS,CAAC,CAAC;QAC3C,IAAI,CAAC,EAAE,CAAC;YACN,IAAI,CAAC,gBAAgB,GAAG,CAAC,CAAC,IAAI,CAAC;YAC/B,IAAI,CAAC,eAAe,GAAG,CAAC,CAAC,GAAG,CAAC;QAC/B,CAAC;IACH,CAAC,CAAC;IAEM,UAAU,CAAC,IAAY,EAAE,EAAU;QACzC,MAAM,IAAI,GAAG,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,IAAI,EAAE,CAAC;QACvC,OAAO,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC,CAAC,EAAE,KAAK,EAAE,CAAC,IAAI,IAAI,CAAC;IAC/C,CAAC;IAED,sBAAsB;IACtB,OAAO,CAAC,IAAiD;QACvD,IAAI,CAAC,UAAU,GAAG,IAAI,CAAC;IACzB,CAAC;IAED,8BAA8B;IACtB,kBAAkB;QACxB,IAAI,CAAC,IAAI,CAAC,WAAW;YAAE,OAAO,EAAE,CAAC;QACjC,OAAO,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,WAAW,CAAC,IAAI,EAAE,CAAC;IAC/C,CAAC;IAEO,oBAAoB,CAAC,EAAU;QACrC,IAAI,CAAC,iBAAiB,GAAG,EAAE,CAAC;QAC5B,MAAM,CAAC,GAAG,IAAI,CAAC,WAAW,CAAC,CAAC,CAAC,IAAI,CAAC,UAAU,CAAC,IAAI,CAAC,WAAW,EAAE,EAAE,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC;QAC1E,IAAI,CAAC,EAAE,CAAC;YACN,IAAI,CAAC,gBAAgB,GAAG,CAAC,CAAC,IAAI,CAAC;YAC/B,IAAI,CAAC,eAAe,GAAG,CAAC,CAAC,GAAG,CAAC;QAC/B,CAAC;IACH,CAAC;IAED,qBAAqB,GAAG,GAAG,EAAE;QAC3B,IAAI,CAAC,IAAI,CAAC,WAAW,IAAI,CAAC,IAAI,CAAC,iBAAiB;YAAE,OAAO;QAEzD,IAAI,CAAC,WAAW,EAAE,CAAC;QAEnB,MAAM,IAAI,GAAG,IAAI,CAAC,WAAW,CAAC;QAC9B,MAAM,IAAI,GAAG,CAAC,GAAG,CAAC,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,IAAI,EAAE,CAAC,CAAC,CAAC;QAC9C,MAAM,GAAG,GAAG,IAAI,CAAC,SAAS,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC,CAAC,EAAE,KAAK,IAAI,CAAC,iBAAiB,CAAC,CAAC;QACnE,IAAI,GAAG,GAAG,CAAC;YAAE,OAAO;QAEpB,IAAI,CAAC,GAAG,CAAC,GAAG;YACV,GAAG,IAAI,CAAC,GAAG,CAAC;YACZ,IAAI,EAAE,IAAI,CAAC,gBAAgB;YAC3B,GAAG,EAAE,IAAI,CAAC,eAAe;SAC1B,CAAC;QAEF,IAAI,CAAC,QAAQ,GAAG,EAAE,GAAG,IAAI,CAAC,QAAQ,EAAE,CAAC,IAAI,CAAC,EAAE,IAAI,EAAE,CAAC;QACnD,IAAI,CAAC,OAAO,EAAE,CAAC;IACjB,CAAC,CAAC;IAEM,KAAK,CAAC,SAAS,CAAC,IAAY;QAClC,MAAM,CAAC,GAAG,IAAI,CAAC,WAAW,EAAE,CAAC;QAC7B,IAAI,CAAC,CAAC,CAAC,IAAI,EAAE;YAAE,OAAO,MAAM,CAAC;QAC7B,IAAI,CAAC,CAAC,QAAQ,CAAC,GAAG,CAAC;YAAE,OAAO,UAAU,CAAC;QACvC,IAAI,CAAC,CAAC,QAAQ,CAAC,WAAW,CAAC,IAAI,CAAC,CAAC,MAAM,GAAG,EAAE;YAAE,OAAO,WAAW,CAAC;QACjE,IAAI,CAAC,CAAC,QAAQ,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC,QAAQ,CAAC,KAAK,CAAC;YAAE,OAAO,MAAM,CAAC;QAC3D,IAAI,CAAC,CAAC,QAAQ,CAAC,MAAM,CAAC;YAAE,OAAO,MAAM,CAAC;QACtC,OAAO,MAAM,CAAC;IAChB,CAAC;IAED,uBAAuB,GAAG,GAAG,EAAE;QAC7B,IAAI,CAAC,IAAI,CAAC,WAAW,IAAI,CAAC,IAAI,CAAC,iBAAiB;YAAE,OAAO;QAEzD,IAAI,CAAC,WAAW,EAAE,CAAC;QAEnB,MAAM,IAAI,GAAG,IAAI,CAAC,WAAW,CAAC;QAC9B,MAAM,IAAI,GAAG,CAAC,GAAG,CAAC,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,IAAI,EAAE,CAAC,CAAC,CAAC;QAE9C,MAAM,OAAO,GAAG,IAAI,CAAC,MAAM,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC,CAAC,EAAE,KAAK,IAAI,CAAC,iBAAiB,CAAC,CAAC;QACpE,IAAI,CAAC,QAAQ,GAAG,EAAE,GAAG,IAAI,CAAC,QAAQ,EAAE,CAAC,IAAI,CAAC,EAAE,OAAO,EAAE,CAAC;QACtD,IAAI,CAAC,OAAO,EAAE,CAAC;QAEf,IAAI,CAAC,iBAAiB,GAAG,IAAI,CAAC;QAC9B,IAAI,CAAC,gBAAgB,GAAG,EAAE,CAAC;QAC3B,IAAI,CAAC,eAAe,GAAG,MAAM,CAAC;IAChC,CAAC,CAAC;IAEF,YAAY,GAAG,GAAG,EAAE;QAClB,IAAI,CAAC,WAAW,GAAG,KAAK,CAAC;QACzB,IAAI,CAAC,WAAW,GAAG,IAAI,CAAC;QACxB,IAAI,CAAC,iBAAiB,GAAG,IAAI,CAAC;QAC9B,IAAI,CAAC,gBAAgB,GAAG,EAAE,CAAC;QAC3B,IAAI,CAAC,eAAe,GAAG,MAAM,CAAC;IAChC,CAAC,CAAC;IAEF,sCAAsC;IACtC,UAAU,GAAG,GAAG,EAAE;QAChB,MAAM,IAAI,GAAG;YACX,OAAO,EAAE,CAAC;YACV,GAAG,EAAE,IAAI,CAAC,GAAG;YACb,QAAQ,EAAE,IAAI,CAAC,QAAQ;YACvB,KAAK,EAAE,IAAI,CAAC,KAAK;YACjB,IAAI,EAAE,IAAI,CAAC,IAAI;YACf,UAAU,EAAE,IAAI,CAAC,UAAU;YAC3B,WAAW,EAAE,IAAI,CAAC,WAAW;YAC7B,QAAQ,EAAE,IAAI,CAAC,QAAQ;SACxB,CAAC;QAEF,MAAM,IAAI,GAAG,IAAI,IAAI,CAAC,CAAC,IAAI,CAAC,SAAS,CAAC,IAAI,EAAE,IAAI,EAAE,CAAC,CAAC,CAAC,EAAE;YACrD,IAAI,EAAE,kBAAkB;SACzB,CAAC,CAAC;QACH,MAAM,GAAG,GAAG,GAAG,CAAC,eAAe,CAAC,IAAI,CAAC,CAAC;QAEtC,MAAM,CAAC,GAAG,QAAQ,CAAC,aAAa,CAAC,GAAG,CAAC,CAAC;QACtC,CAAC,CAAC,IAAI,GAAG,GAAG,CAAC;QACb,CAAC,CAAC,QAAQ,GAAG,uBAAuB,CAAC;QACrC,CAAC,CAAC,KAAK,EAAE,CAAC;QACV,GAAG,CAAC,eAAe,CAAC,GAAG,CAAC,CAAC;IAC3B,CAAC,CAAC;IAEF,kBAAkB,GAAG,CAAC,CAAQ,EAAE,EAAE;QAChC,MAAM,KAAK,GAAG,CAAC,CAAC,MAA0B,CAAC;QAC3C,MAAM,IAAI,GAAG,KAAK,CAAC,KAAK,EAAE,CAAC,CAAC,CAAC,CAAC;QAC9B,IAAI,CAAC,IAAI;YAAE,OAAO;QAElB,MAAM,MAAM,GAAG,IAAI,UAAU,EAAE,CAAC;QAChC,MAAM,CAAC,MAAM,GAAG,GAAG,EAAE;YACnB,IAAI,CAAC;gBACH,MAAM,IAAI,GAAG,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,MAAgB,CAAC,CAAC;gBAEjD,IAAI,CAAC,WAAW,EAAE,CAAC;gBAEnB,IAAI,CAAC,WAAW,GAAG,IAAI,CAAC,WAAW,IAAI,EAAE,CAAC;gBAC1C,IAAI,CAAC,QAAQ,GAAG,IAAI,CAAC,QAAQ,IAAI,EAAE,CAAC;gBAEpC,IAAI,IAAI,CAAC,KAAK;oBAAE,IAAI,CAAC,KAAK,GAAG,IAAI,CAAC,KAAK,CAAC;gBACxC,IAAI,IAAI,CAAC,IAAI;oBAAE,IAAI,CAAC,IAAI,GAAG,IAAI,CAAC,IAAI,CAAC;gBACrC,IAAI,IAAI,CAAC,UAAU;oBAAE,IAAI,CAAC,UAAU,GAAG,IAAI,CAAC,UAAU,CAAC;gBACvD,IAAI,CAAC,OAAO,EAAE,CAAC;YACjB,CAAC;YAAC,MAAM,CAAC;gBACP,SAAS;YACX,CAAC;oBAAS,CAAC;gBACT,KAAK,CAAC,KAAK,GAAG,EAAE,CAAC;YACnB,CAAC;QACH,CAAC,CAAC;QACF,MAAM,CAAC,UAAU,CAAC,IAAI,CAAC,CAAC;IAC1B,CAAC,CAAC;IAEF,yBAAyB;IACzB,aAAa;QACX,IAAI,CAAC,IAAI,CAAC,WAAW,IAAI,CAAC,IAAI,CAAC,WAAW;YAAE,OAAO,IAAI,CAAC;QAExD,MAAM,YAAY,GAAG,IAAI,CAAC,kBAAkB,EAAE,CAAC;QAC/C,MAAM,QAAQ,GAAG,IAAI,CAAC,IAAI,KAAK,QAAQ,IAAI,IAAI,CAAC,QAAQ,CAAC;QAEzD,MAAM,QAAQ,GACZ,IAAI,CAAC,iBAAiB;YACtB,YAAY,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC,CAAC,EAAE,KAAK,IAAI,CAAC,iBAAiB,CAAC,CAAC;QAE5D,OAAO,CACL,WAAK,KAAK,EAAC,iBAAiB;YAC1B,WAAK,KAAK,EAAC,gBAAgB;gBACzB;;oBAA4B,IAAI,CAAC,WAAW,CAAU;gBACtD,cAAQ,KAAK,EAAC,WAAW,EAAC,OAAO,EAAE,IAAI,CAAC,YAAY,aAE3C,CACL;YAEN,WAAK,KAAK,EAAC,cAAc,IACtB,YAAY,CAAC,MAAM,KAAK,CAAC,CAAC,CAAC,CAAC,CAC3B,WAAK,KAAK,EAAC,OAAO,gCAAgC,CACnD,CAAC,CAAC,CAAC,CACF,YAAY,CAAC,GAAG,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,CACtB,WACE,KAAK,EAAE;oBACL,cAAc,EAAE,IAAI;oBACpB,QAAQ,EAAE,CAAC,CAAC,EAAE,KAAK,IAAI,CAAC,iBAAiB;iBAC1C,EACD,OAAO,EAAE,GAAG,EAAE,CAAC,IAAI,CAAC,oBAAoB,CAAC,CAAC,CAAC,EAAE,CAAC;gBAE9C,WAAK,KAAK,EAAC,cAAc;oBACvB,YAAM,KAAK,EAAC,WAAW,IAAE,CAAC,CAAC,IAAI,KAAK,SAAS,CAAC,CAAC,CAAC,SAAS,CAAC,CAAC,CAAC,MAAM,CAAQ;oBAC1E,YAAM,KAAK,EAAC,WAAW;;wBAAK,IAAI,IAAI,CAAC,CAAC,CAAC,SAAS,CAAC,CAAC,cAAc,EAAE,CAAQ,CACtE;gBACN,WAAK,KAAK,EAAC,uBAAuB;;oBAAO,CAAC,CAAC,GAAG,CAAO;gBACrD,WAAK,KAAK,EAAC,sBAAsB,IAC9B,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC,CAAC,CAAC,eAAe,CAC3C,CACF,CACP,CAAC,CACH,CACG;YAEN,WAAK,KAAK,EAAC,gBAAgB,IACxB,QAAQ,CAAC,CAAC,CAAC,CACV;gBACE,WAAK,KAAK,EAAC,aAAa;;oBACb,QAAQ,CAAC,IAAI;;oBAAW,IAAI,IAAI,CAAC,QAAQ,CAAC,SAAS,CAAC,CAAC,cAAc,EAAE,CAC1E;gBAEN,aAAO,KAAK,EAAC,WAAW;;oBAEtB,cACE,QAAQ,EAAE,QAAQ,EAClB,QAAQ,EAAE,CAAC,CAAM,EAAE,EAAE,CAAC,CAAC,IAAI,CAAC,eAAe,GAAG,CAAC,CAAC,MAAM,CAAC,KAAK,CAAC,IAE5D,WAAW,CAAC,GAAG,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,CACtB,cAAQ,KAAK,EAAE,CAAC,EAAE,QAAQ,EAAE,IAAI,CAAC,eAAe,KAAK,CAAC,IACnD,CAAC,CACK,CACV,CAAC,CACK,CACH;gBAER,gBACE,KAAK,EAAE,IAAI,CAAC,gBAAgB,EAC5B,QAAQ,EAAE,QAAQ,EAClB,OAAO,EAAE,CAAC,CAAM,EAAE,EAAE,CAAC,CAAC,IAAI,CAAC,gBAAgB,GAAG,CAAC,CAAC,MAAM,CAAC,KAAK,CAAC,EAC7D,WAAW,EAAC,iCAAiC,GACnC;gBAEZ,WAAK,KAAK,EAAC,gBAAgB;oBACzB,cAAQ,QAAQ,EAAE,QAAQ,EAAE,OAAO,EAAE,IAAI,CAAC,qBAAqB,WAEtD;oBAET,cACE,KAAK,EAAC,YAAY,EAClB,QAAQ,EAAE,QAAQ,EAClB,OAAO,EAAE,KAAK,IAAI,EAAE;4BAClB,IAAI,CAAC,eAAe,GAAG,MAAM,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,gBAAgB,CAAC,CAAC;4BACnE,IAAI,CAAC,qBAAqB,EAAE,CAAC;wBAC/B,CAAC,4BAGM;oBAET,cACE,KAAK,EAAC,YAAY,EAClB,QAAQ,EAAE,QAAQ,EAClB,OAAO,EAAE,IAAI,CAAC,uBAAuB,0BAG9B,CACL,CACL,CACJ,CAAC,CAAC,CAAC,CACF,WAAK,KAAK,EAAC,aAAa,+CAA+C,CACxE,CACG,CACF,CACP,CAAC;IACJ,CAAC;IAED,0BAA0B;IAC1B,MAAM;QACJ,MAAM,QAAQ,GAAG,IAAI,CAAC,IAAI,KAAK,QAAQ,IAAI,IAAI,CAAC,QAAQ,CAAC;QACzD,MAAM,KAAK,GAAG,KAAK,CAAC,IAAI,CAAC,EAAE,MAAM,EAAE,IAAI,CAAC,QAAQ,IAAI,CAAC,EAAE,EAAE,CAAC,CAAC,EAAE,CAAC,EAAE,EAAE,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC;QAE1E,OAAO,CACL,4DAAK,KAAK,EAAE,0BAA0B,IAAI,CAAC,KAAK,EAAE;YAE/C,CAAC,IAAI,CAAC,QAAQ,IAAI,CACjB,4DAAK,KAAK,EAAC,SAAS;gBAClB,+DACE,QAAQ,EAAE,QAAQ,EAClB,KAAK,EAAE,IAAI,CAAC,UAAU,KAAK,QAAQ,CAAC,CAAC,CAAC,QAAQ,CAAC,CAAC,CAAC,EAAE,EACnD,OAAO,EAAE,GAAG,EAAE,CAAC,IAAI,CAAC,OAAO,CAAC,QAAQ,CAAC,aAG9B;gBACT,+DACE,QAAQ,EAAE,QAAQ,EAClB,KAAK,EAAE,IAAI,CAAC,UAAU,KAAK,WAAW,CAAC,CAAC,CAAC,QAAQ,CAAC,CAAC,CAAC,EAAE,EACtD,OAAO,EAAE,GAAG,EAAE,CAAC,IAAI,CAAC,OAAO,CAAC,WAAW,CAAC,gBAGjC;gBACT,+DACE,QAAQ,EAAE,QAAQ,EAClB,KAAK,EAAE,IAAI,CAAC,UAAU,KAAK,SAAS,CAAC,CAAC,CAAC,QAAQ,CAAC,CAAC,CAAC,EAAE,EACpD,OAAO,EAAE,GAAG,EAAE,CAAC,IAAI,CAAC,OAAO,CAAC,SAAS,CAAC,cAG/B;gBACT,+DACE,QAAQ,EAAE,QAAQ,EAClB,KAAK,EAAE,IAAI,CAAC,UAAU,KAAK,MAAM,CAAC,CAAC,CAAC,QAAQ,CAAC,CAAC,CAAC,EAAE,EACjD,OAAO,EAAE,GAAG,EAAE,CAAC,IAAI,CAAC,OAAO,CAAC,MAAM,CAAC,WAG5B;gBAET,4DAAK,KAAK,EAAC,gBAAgB,GAAG;gBAE9B,+DAAQ,QAAQ,EAAE,QAAQ,EAAE,OAAO,EAAE,IAAI,CAAC,IAAI,kBAErC;gBACT,+DAAQ,QAAQ,EAAE,QAAQ,EAAE,OAAO,EAAE,IAAI,CAAC,IAAI,kBAErC;gBAET,4DAAK,KAAK,EAAC,gBAAgB,GAAG;gBAE9B,+DAAQ,OAAO,EAAE,IAAI,CAAC,UAAU,oBAAmB;gBACnD,+DAAQ,QAAQ,EAAE,QAAQ,EAAE,OAAO,EAAE,GAAG,EAAE,CAAC,IAAI,CAAC,WAAW,EAAE,KAAK,EAAE,oBAE3D;gBACT,8DACE,IAAI,EAAC,MAAM,EACX,MAAM,EAAC,kBAAkB,EACzB,KAAK,EAAE,EAAE,OAAO,EAAE,MAAM,EAAE,EAC1B,GAAG,EAAE,CAAC,EAAE,EAAE,EAAE,CAAC,CAAC,IAAI,CAAC,WAAW,GAAG,EAAsB,CAAC,EACxD,QAAQ,EAAE,IAAI,CAAC,kBAAkB,GACjC;gBAEF,yEAAqB;gBACrB,+DAAQ,QAAQ,EAAE,CAAC,CAAM,EAAE,EAAE,CAAC,CAAC,IAAI,CAAC,KAAK,GAAG,CAAC,CAAC,MAAM,CAAC,KAAK,CAAC;oBACzD,+DAAQ,KAAK,EAAC,OAAO,EAAC,QAAQ,EAAE,IAAI,CAAC,KAAK,KAAK,OAAO,YAE7C;oBACT,+DAAQ,KAAK,EAAC,MAAM,EAAC,QAAQ,EAAE,IAAI,CAAC,KAAK,KAAK,MAAM,WAE3C;oBACT,+DAAQ,KAAK,EAAC,OAAO,EAAC,QAAQ,EAAE,IAAI,CAAC,KAAK,KAAK,OAAO,YAE7C,CACF;gBAET,wEAAoB;gBACpB,+DAAQ,QAAQ,EAAE,CAAC,CAAM,EAAE,EAAE,CAAC,CAAC,IAAI,CAAC,IAAI,GAAG,CAAC,CAAC,MAAM,CAAC,KAAK,CAAC;oBACxD,+DAAQ,KAAK,EAAC,QAAQ,EAAC,QAAQ,EAAE,IAAI,CAAC,IAAI,KAAK,QAAQ,aAE9C;oBACT,+DAAQ,KAAK,EAAC,QAAQ,EAAC,QAAQ,EAAE,IAAI,CAAC,IAAI,KAAK,QAAQ,aAE9C,CACF,CACL,CACP;YAED,4DAAK,KAAK,EAAC,aAAa;gBACtB,4DACE,KAAK,EAAE;wBACL,WAAW,EAAE,IAAI;wBACjB,aAAa,EAAE,IAAI,CAAC,WAAW;qBAChC;oBAED,4DAAK,KAAK,EAAC,iBAAiB,IACzB,KAAK,CAAC,GAAG,CAAC,CAAC,OAAO,EAAE,EAAE,CAAC,CACtB,WACE,KAAK,EAAC,sBAAsB,EAC5B,GAAG,EAAE,CAAC,EAAE,EAAE,EAAE,CAAC,IAAI,CAAC,oBAAoB,CAAC,EAAiB,EAAE,OAAO,CAAC;wBAElE,gBACE,GAAG,EAAE,IAAI,CAAC,GAAG,EACb,IAAI,EAAE,OAAO,EACb,GAAG,EAAE,OAAO,EACZ,KAAK,EAAE,IAAI,CAAC,KAAK,EACjB,QAAQ,EAAE,IAAI,CAAC,QAAQ,EACvB,QAAQ,EAAE,QAAQ,EAClB,UAAU,EAAE,IAAI,CAAC,UAAU,EAC3B,OAAO,EAAE,CAAC,CAAC,IAAI,CAAC,YAAY,CAAC,OAAO,CAAC,EACrC,WAAW,EAAE,IAAI,CAAC,WAAW,CAAC,OAAO,CAAC,IAAI,EAAE,EAC5C,QAAQ,EAAE,IAAI,CAAC,QAAQ,CAAC,OAAO,CAAC,IAAI,EAAE,EACtC,mBAAmB,EAAE,IAAI,CAAC,uBAAuB,EACjD,qBAAqB,EAAE,IAAI,CAAC,yBAAyB,EACrD,oBAAoB,EAAE,IAAI,CAAC,wBAAwB,GACzC,CACR,CACP,CAAC,CACE,CACF;gBAEL,CAAC,IAAI,CAAC,QAAQ,IAAI,IAAI,CAAC,aAAa,EAAE,CACnC,CACF,CACP,CAAC;IACJ,CAAC;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;CACF","sourcesContent":["// src/components/doc-viewer/doc-viewer.tsx\r\nimport { Component, h, Prop, State } from '@stencil/core';\r\nimport { NormalizedRect } from '../../types/annotations';\r\nimport { PageComment, AnnotationKind } from '../../types/comments';\r\nimport { HistoryManager } from '../../utils/history';\r\n\r\nconst pdfjsLib = (window as any).pdfjsLib;\r\nconst TAG_OPTIONS = ['None', 'Important', 'Todo', 'Question', 'Idea'];\r\n\r\nexport type FileType = 'pdf' | 'image' | 'text';\r\n\r\n@Component({\r\n  tag: 'doc-viewer',\r\n  styleUrl: 'doc-viewer.css',\r\n  shadow: false,\r\n})\r\nexport class DocViewer {\r\n  @Prop() src!: string;\r\n  @Prop() scale: number = 1.2;\r\n  @Prop() fileType: FileType = 'pdf';\r\n\r\n  @Prop({ mutable: true, reflect: true }) embedded: boolean = false;\r\n\r\n  @Prop({ mutable: true, reflect: true }) theme: 'light' | 'dark' | 'sepia' = 'light';\r\n  @Prop({ mutable: true, reflect: true }) mode: 'viewer' | 'editor' = 'editor';\r\n\r\n  @State() numPages = 0;\r\n  @State() activeTool: 'select' | 'highlight' | 'comment' | 'note' = 'select';\r\n\r\n  @State() annotations: Record<number, NormalizedRect[]> = {};\r\n  @State() comments: Record<number, PageComment[]> = {};\r\n\r\n  @State() sidebarOpen = false;\r\n  @State() sidebarPage: number | null = null;\r\n  @State() sidebarSelectedId: string | null = null;\r\n  @State() sidebarDraftText = '';\r\n  @State() sidebarDraftTag = 'None';\r\n\r\n  // virtual / lazy: which pages are visible\r\n  @State() visiblePages: { [page: number]: boolean } = { 1: true };\r\n\r\n  private history = new HistoryManager<{\r\n    annotations: Record<number, NormalizedRect[]>;\r\n    comments: Record<number, PageComment[]>;\r\n  }>();\r\n\r\n  private fileInputEl?: HTMLInputElement;\r\n  private intersectionObserver?: IntersectionObserver;\r\n\r\n  // ---------- STORAGE ----------\r\n  private storageKey(kind: 'annotations' | 'comments'): string {\r\n    const base = this.src || 'default';\r\n    const safe = base.replace(/[^a-z0-9]/gi, '_');\r\n    return `dv_${kind}_${safe}`;\r\n  }\r\n\r\n  private detectFileType(src: string): FileType {\r\n    const s = src.toLowerCase();\r\n    if (s.endsWith('.pdf')) return 'pdf';\r\n    if (s.match(/\\.(png|jpe?g|gif|bmp|webp)$/)) return 'image';\r\n    if (s.match(/\\.(txt|md)$/)) return 'text';\r\n    return 'text';\r\n  }\r\n\r\n  async componentDidLoad() {\r\n    const url = new URL(window.location.href);\r\n    if (url.searchParams.get('embedded') === 'true') this.embedded = true;\r\n\r\n    const ann = localStorage.getItem(this.storageKey('annotations'));\r\n    if (ann) this.annotations = JSON.parse(ann);\r\n\r\n    const cm = localStorage.getItem(this.storageKey('comments'));\r\n    if (cm) this.comments = JSON.parse(cm);\r\n\r\n    if (!this.fileType) this.fileType = this.detectFileType(this.src);\r\n\r\n    if (this.fileType === 'pdf') {\r\n      const task = pdfjsLib.getDocument(this.src);\r\n      const pdf = await task.promise;\r\n      this.numPages = pdf.numPages;\r\n    } else {\r\n      this.numPages = 1;\r\n    }\r\n\r\n    this.history.pushState({\r\n      annotations: this.annotations,\r\n      comments: this.comments,\r\n    });\r\n\r\n    this.setupIntersectionObserver();\r\n  }\r\n\r\n  private setupIntersectionObserver() {\r\n    if (typeof IntersectionObserver === 'undefined') return;\r\n\r\n    this.intersectionObserver = new IntersectionObserver(\r\n      (entries) => {\r\n        const updated = { ...this.visiblePages };\r\n        let changed = false;\r\n\r\n        for (const entry of entries) {\r\n          const el = entry.target as HTMLElement;\r\n          const pageStr = el.getAttribute('data-page');\r\n          if (!pageStr) continue;\r\n          const page = parseInt(pageStr, 10);\r\n          if (!page) continue;\r\n\r\n          if (entry.isIntersecting && !updated[page]) {\r\n            updated[page] = true;\r\n            changed = true;\r\n          }\r\n        }\r\n\r\n        if (changed) {\r\n          this.visiblePages = updated;\r\n        }\r\n      },\r\n      {\r\n        threshold: 0.2,\r\n      }\r\n    );\r\n  }\r\n\r\n  private observePageContainer = (el: HTMLElement | null, page: number) => {\r\n    if (!el || !this.intersectionObserver) return;\r\n    el.setAttribute('data-page', String(page));\r\n    this.intersectionObserver.observe(el);\r\n  };\r\n\r\n  // ===== HISTORY =====\r\n  private pushHistory() {\r\n    this.history.pushState({\r\n      annotations: this.annotations,\r\n      comments: this.comments,\r\n    });\r\n  }\r\n\r\n  private persist() {\r\n    localStorage.setItem(this.storageKey('annotations'), JSON.stringify(this.annotations));\r\n    localStorage.setItem(this.storageKey('comments'), JSON.stringify(this.comments));\r\n  }\r\n\r\n  undo = () => {\r\n    const state = this.history.undo({\r\n      annotations: this.annotations,\r\n      comments: this.comments,\r\n    });\r\n    if (!state) return;\r\n    this.annotations = state.annotations;\r\n    this.comments = state.comments;\r\n    this.persist();\r\n  };\r\n\r\n  redo = () => {\r\n    const state = this.history.redo({\r\n      annotations: this.annotations,\r\n      comments: this.comments,\r\n    });\r\n    if (!state) return;\r\n    this.annotations = state.annotations;\r\n    this.comments = state.comments;\r\n    this.persist();\r\n  };\r\n\r\n  // ===== EVENTS FROM PAGES =====\r\n  handleAnnotationCreated = (ev: CustomEvent<{ page: number; rect: NormalizedRect }>) => {\r\n    const { page, rect } = ev.detail;\r\n    this.pushHistory();\r\n\r\n    const clone = { ...this.annotations };\r\n    const list = clone[page] ? [...clone[page]] : [];\r\n    list.push(rect);\r\n    clone[page] = list;\r\n\r\n    this.annotations = clone;\r\n    this.persist();\r\n  };\r\n\r\n  handleCommentAddRequested = (\r\n    ev: CustomEvent<{ page: number; x: number; y: number; kind: AnnotationKind }>\r\n  ) => {\r\n    this.pushHistory();\r\n\r\n    const { page, x, y, kind } = ev.detail;\r\n    const id = crypto.randomUUID ? crypto.randomUUID() : Date.now().toString(36);\r\n\r\n    const updated = { ...this.comments };\r\n    const list = updated[page] ? [...updated[page]] : [];\r\n\r\n    list.push({\r\n      id,\r\n      kind,\r\n      x,\r\n      y,\r\n      text: '',\r\n      tag: 'None',\r\n      createdAt: new Date().toISOString(),\r\n    });\r\n\r\n    updated[page] = list;\r\n    this.comments = updated;\r\n    this.persist();\r\n\r\n    this.sidebarOpen = true;\r\n    this.sidebarPage = page;\r\n    this.sidebarSelectedId = id;\r\n    this.sidebarDraftText = '';\r\n    this.sidebarDraftTag = 'None';\r\n  };\r\n\r\n  handleCommentIconClicked = (ev: CustomEvent<{ page: number; commentId: string }>) => {\r\n    const { page, commentId } = ev.detail;\r\n\r\n    this.sidebarOpen = true;\r\n    this.sidebarPage = page;\r\n    this.sidebarSelectedId = commentId;\r\n\r\n    const c = this.getComment(page, commentId);\r\n    if (c) {\r\n      this.sidebarDraftText = c.text;\r\n      this.sidebarDraftTag = c.tag;\r\n    }\r\n  };\r\n\r\n  private getComment(page: number, id: string) {\r\n    const list = this.comments[page] || [];\r\n    return list.find((c) => c.id === id) || null;\r\n  }\r\n\r\n  // ===== TOOLBAR =====\r\n  setTool(tool: 'select' | 'highlight' | 'comment' | 'note') {\r\n    this.activeTool = tool;\r\n  }\r\n\r\n  // ===== SIDEBAR HELPERS =====\r\n  private getSidebarComments() {\r\n    if (!this.sidebarPage) return [];\r\n    return this.comments[this.sidebarPage] || [];\r\n  }\r\n\r\n  private selectSidebarComment(id: string) {\r\n    this.sidebarSelectedId = id;\r\n    const c = this.sidebarPage ? this.getComment(this.sidebarPage, id) : null;\r\n    if (c) {\r\n      this.sidebarDraftText = c.text;\r\n      this.sidebarDraftTag = c.tag;\r\n    }\r\n  }\r\n\r\n  saveSidebarAnnotation = () => {\r\n    if (!this.sidebarPage || !this.sidebarSelectedId) return;\r\n\r\n    this.pushHistory();\r\n\r\n    const page = this.sidebarPage;\r\n    const list = [...(this.comments[page] || [])];\r\n    const idx = list.findIndex((c) => c.id === this.sidebarSelectedId);\r\n    if (idx < 0) return;\r\n\r\n    list[idx] = {\r\n      ...list[idx],\r\n      text: this.sidebarDraftText,\r\n      tag: this.sidebarDraftTag,\r\n    };\r\n\r\n    this.comments = { ...this.comments, [page]: list };\r\n    this.persist();\r\n  };\r\n\r\n  private async mockAITag(text: string): Promise<string> {\r\n    const t = text.toLowerCase();\r\n    if (!t.trim()) return 'None';\r\n    if (t.includes('?')) return 'Question';\r\n    if (t.includes('important') || t.length > 80) return 'Important';\r\n    if (t.includes('todo') || t.includes('fix')) return 'Todo';\r\n    if (t.includes('idea')) return 'Idea';\r\n    return 'Idea';\r\n  }\r\n\r\n  deleteSidebarAnnotation = () => {\r\n    if (!this.sidebarPage || !this.sidebarSelectedId) return;\r\n\r\n    this.pushHistory();\r\n\r\n    const page = this.sidebarPage;\r\n    const list = [...(this.comments[page] || [])];\r\n\r\n    const updated = list.filter((c) => c.id !== this.sidebarSelectedId);\r\n    this.comments = { ...this.comments, [page]: updated };\r\n    this.persist();\r\n\r\n    this.sidebarSelectedId = null;\r\n    this.sidebarDraftText = '';\r\n    this.sidebarDraftTag = 'None';\r\n  };\r\n\r\n  closeSidebar = () => {\r\n    this.sidebarOpen = false;\r\n    this.sidebarPage = null;\r\n    this.sidebarSelectedId = null;\r\n    this.sidebarDraftText = '';\r\n    this.sidebarDraftTag = 'None';\r\n  };\r\n\r\n  // ===== EXPORT / IMPORT (STATE) =====\r\n  exportJson = () => {\r\n    const data = {\r\n      version: 1,\r\n      src: this.src,\r\n      fileType: this.fileType,\r\n      theme: this.theme,\r\n      mode: this.mode,\r\n      activeTool: this.activeTool,\r\n      annotations: this.annotations,\r\n      comments: this.comments,\r\n    };\r\n\r\n    const blob = new Blob([JSON.stringify(data, null, 2)], {\r\n      type: 'application/json',\r\n    });\r\n    const url = URL.createObjectURL(blob);\r\n\r\n    const a = document.createElement('a');\r\n    a.href = url;\r\n    a.download = 'doc-viewer-state.json';\r\n    a.click();\r\n    URL.revokeObjectURL(url);\r\n  };\r\n\r\n  onImportFileChange = (e: Event) => {\r\n    const input = e.target as HTMLInputElement;\r\n    const file = input.files?.[0];\r\n    if (!file) return;\r\n\r\n    const reader = new FileReader();\r\n    reader.onload = () => {\r\n      try {\r\n        const data = JSON.parse(reader.result as string);\r\n\r\n        this.pushHistory();\r\n\r\n        this.annotations = data.annotations || {};\r\n        this.comments = data.comments || {};\r\n\r\n        if (data.theme) this.theme = data.theme;\r\n        if (data.mode) this.mode = data.mode;\r\n        if (data.activeTool) this.activeTool = data.activeTool;\r\n        this.persist();\r\n      } catch {\r\n        // ignore\r\n      } finally {\r\n        input.value = '';\r\n      }\r\n    };\r\n    reader.readAsText(file);\r\n  };\r\n\r\n  // ===== SIDEBAR UI =====\r\n  renderSidebar() {\r\n    if (!this.sidebarOpen || !this.sidebarPage) return null;\r\n\r\n    const pageComments = this.getSidebarComments();\r\n    const readOnly = this.mode === 'viewer' || this.embedded;\r\n\r\n    const selected =\r\n      this.sidebarSelectedId &&\r\n      pageComments.find((c) => c.id === this.sidebarSelectedId);\r\n\r\n    return (\r\n      <div class=\"comment-sidebar\">\r\n        <div class=\"sidebar-header\">\r\n          <strong>Annotations â€“ Page {this.sidebarPage}</strong>\r\n          <button class=\"close-btn\" onClick={this.closeSidebar}>\r\n            âœ•\r\n          </button>\r\n        </div>\r\n\r\n        <div class=\"comment-list\">\r\n          {pageComments.length === 0 ? (\r\n            <div class=\"empty\">No comments or notes yet.</div>\r\n          ) : (\r\n            pageComments.map((c) => (\r\n              <div\r\n                class={{\r\n                  'comment-item': true,\r\n                  selected: c.id === this.sidebarSelectedId,\r\n                }}\r\n                onClick={() => this.selectSidebarComment(c.id)}\r\n              >\r\n                <div class=\"comment-meta\">\r\n                  <span class=\"kind-pill\">{c.kind === 'comment' ? 'Comment' : 'Note'}</span>\r\n                  <span class=\"meta-time\"> â€¢ {new Date(c.createdAt).toLocaleString()}</span>\r\n                </div>\r\n                <div class=\"comment-meta tag-line\">Tag: {c.tag}</div>\r\n                <div class=\"comment-text-preview\">\r\n                  {c.text ? c.text.slice(0, 80) : '(no text yet)'}\r\n                </div>\r\n              </div>\r\n            ))\r\n          )}\r\n        </div>\r\n\r\n        <div class=\"comment-editor\">\r\n          {selected ? (\r\n            <>\r\n              <div class=\"editor-meta\">\r\n                Editing {selected.kind} created {new Date(selected.createdAt).toLocaleString()}\r\n              </div>\r\n\r\n              <label class=\"tag-label\">\r\n                Tag:\r\n                <select\r\n                  disabled={readOnly}\r\n                  onChange={(e: any) => (this.sidebarDraftTag = e.target.value)}\r\n                >\r\n                  {TAG_OPTIONS.map((t) => (\r\n                    <option value={t} selected={this.sidebarDraftTag === t}>\r\n                      {t}\r\n                    </option>\r\n                  ))}\r\n                </select>\r\n              </label>\r\n\r\n              <textarea\r\n                value={this.sidebarDraftText}\r\n                disabled={readOnly}\r\n                onInput={(e: any) => (this.sidebarDraftText = e.target.value)}\r\n                placeholder=\"Type annotation details here...\"\r\n              ></textarea>\r\n\r\n              <div class=\"editor-buttons\">\r\n                <button disabled={readOnly} onClick={this.saveSidebarAnnotation}>\r\n                  Save\r\n                </button>\r\n\r\n                <button\r\n                  class=\"ai-tag-btn\"\r\n                  disabled={readOnly}\r\n                  onClick={async () => {\r\n                    this.sidebarDraftTag = await this.mockAITag(this.sidebarDraftText);\r\n                    this.saveSidebarAnnotation();\r\n                  }}\r\n                >\r\n                  ðŸ¤– Auto-Tag\r\n                </button>\r\n\r\n                <button\r\n                  class=\"delete-btn\"\r\n                  disabled={readOnly}\r\n                  onClick={this.deleteSidebarAnnotation}\r\n                >\r\n                  ðŸ—‘ Delete\r\n                </button>\r\n              </div>\r\n            </>\r\n          ) : (\r\n            <div class=\"editor-meta\">Click a comment or note icon on the doc.</div>\r\n          )}\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  // ===== MAIN RENDER =====\r\n  render() {\r\n    const readOnly = this.mode === 'viewer' || this.embedded;\r\n    const pages = Array.from({ length: this.numPages || 0 }, (_, i) => i + 1);\r\n\r\n    return (\r\n      <div class={`viewer-container theme-${this.theme}`}>\r\n        {/* Toolbar hidden in embedded mode */}\r\n        {!this.embedded && (\r\n          <div class=\"toolbar\">\r\n            <button\r\n              disabled={readOnly}\r\n              class={this.activeTool === 'select' ? 'active' : ''}\r\n              onClick={() => this.setTool('select')}\r\n            >\r\n              Select\r\n            </button>\r\n            <button\r\n              disabled={readOnly}\r\n              class={this.activeTool === 'highlight' ? 'active' : ''}\r\n              onClick={() => this.setTool('highlight')}\r\n            >\r\n              Highlight\r\n            </button>\r\n            <button\r\n              disabled={readOnly}\r\n              class={this.activeTool === 'comment' ? 'active' : ''}\r\n              onClick={() => this.setTool('comment')}\r\n            >\r\n              Comment\r\n            </button>\r\n            <button\r\n              disabled={readOnly}\r\n              class={this.activeTool === 'note' ? 'active' : ''}\r\n              onClick={() => this.setTool('note')}\r\n            >\r\n              Note\r\n            </button>\r\n\r\n            <div class=\"toolbar-spacer\" />\r\n\r\n            <button disabled={readOnly} onClick={this.undo}>\r\n              â¤º Undo\r\n            </button>\r\n            <button disabled={readOnly} onClick={this.redo}>\r\n              â¤¼ Redo\r\n            </button>\r\n\r\n            <div class=\"toolbar-spacer\" />\r\n\r\n            <button onClick={this.exportJson}>â¬† Export</button>\r\n            <button disabled={readOnly} onClick={() => this.fileInputEl?.click()}>\r\n              â¬‡ Import\r\n            </button>\r\n            <input\r\n              type=\"file\"\r\n              accept=\"application/json\"\r\n              style={{ display: 'none' }}\r\n              ref={(el) => (this.fileInputEl = el as HTMLInputElement)}\r\n              onChange={this.onImportFileChange}\r\n            />\r\n\r\n            <label>Theme:</label>\r\n            <select onChange={(e: any) => (this.theme = e.target.value)}>\r\n              <option value=\"light\" selected={this.theme === 'light'}>\r\n                Light\r\n              </option>\r\n              <option value=\"dark\" selected={this.theme === 'dark'}>\r\n                Dark\r\n              </option>\r\n              <option value=\"sepia\" selected={this.theme === 'sepia'}>\r\n                Sepia\r\n              </option>\r\n            </select>\r\n\r\n            <label>Mode:</label>\r\n            <select onChange={(e: any) => (this.mode = e.target.value)}>\r\n              <option value=\"editor\" selected={this.mode === 'editor'}>\r\n                Editor\r\n              </option>\r\n              <option value=\"viewer\" selected={this.mode === 'viewer'}>\r\n                Viewer\r\n              </option>\r\n            </select>\r\n          </div>\r\n        )}\r\n\r\n        <div class=\"viewer-main\">\r\n          <div\r\n            class={{\r\n              'pdf-panel': true,\r\n              'has-sidebar': this.sidebarOpen,\r\n            }}\r\n          >\r\n            <div class=\"pages-container\">\r\n              {pages.map((pageNum) => (\r\n                <div\r\n                  class=\"virtual-page-wrapper\"\r\n                  ref={(el) => this.observePageContainer(el as HTMLElement, pageNum)}\r\n                >\r\n                  <doc-page\r\n                    src={this.src}\r\n                    page={pageNum}\r\n                    key={pageNum}\r\n                    scale={this.scale}\r\n                    fileType={this.fileType}\r\n                    readOnly={readOnly}\r\n                    activeTool={this.activeTool}\r\n                    visible={!!this.visiblePages[pageNum]}  // â­ lazy render\r\n                    annotations={this.annotations[pageNum] || []}\r\n                    comments={this.comments[pageNum] || []}\r\n                    onAnnotationCreated={this.handleAnnotationCreated}\r\n                    onCommentAddRequested={this.handleCommentAddRequested}\r\n                    onCommentIconClicked={this.handleCommentIconClicked}\r\n                  ></doc-page>\r\n                </div>\r\n              ))}\r\n            </div>\r\n          </div>\r\n\r\n          {!this.embedded && this.renderSidebar()}\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n}\r\n"]}